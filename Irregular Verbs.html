<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vocabulary Matching Game</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    @keyframes celebrate {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10% { transform: translateX(-8px); }
      20% { transform: translateX(8px); }
      30% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      50% { transform: translateX(-8px); }
      60% { transform: translateX(8px); }
    }
    
    .shake-error {
      animation: shake 0.6s ease;
      border-color: #ef4444 !important;
      background: #fee2e2 !important;
    }
    
    @keyframes confetti {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(600px) rotate(720deg); opacity: 0; }
    }
    
    .celebrate {
      animation: celebrate 0.5s ease;
    }
    
    .shake {
      animation: shake 0.4s ease;
    }
    
    .confetti-piece {
      position: fixed;
      width: 10px;
      height: 10px;
      animation: confetti 3s ease-out forwards;
      z-index: 1000;
    }
    
    .hint-glow {
      box-shadow: 0 0 20px rgba(251, 191, 36, 0.8);
    }
    
    @keyframes snowfall-game {
      0% { transform: translateY(-10px) translateX(0) rotate(0deg); opacity: 0.8; }
      100% { transform: translateY(100vh) translateX(50px) rotate(360deg); opacity: 0.3; }
    }
    
    .snowflake {
      position: fixed;
      color: white;
      font-size: 20px;
      pointer-events: none;
      z-index: 1;
      animation: snowfall-game linear infinite;
    }
    
    @keyframes sway {
      0%, 100% { transform: translateX(0) rotate(0deg); }
      50% { transform: translateX(10px) rotate(5deg); }
    }
    
    .decoration {
      position: fixed;
      pointer-events: none;
      z-index: 2;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <main id="app" class="h-full w-full overflow-auto"></main><!-- Snowflakes -->
  <div id="snowflakes-container"></div><!-- Winter Decorations -->
  <div id="decorations-container"><!-- Christmas trees -->
   <div class="decoration" style="bottom: 0; left: 5%; font-size: 60px; animation: sway 3s ease-in-out infinite;">
    üéÑ
   </div>
   <div class="decoration" style="bottom: 0; right: 5%; font-size: 60px; animation: sway 3.5s ease-in-out infinite;">
    üéÑ
   </div>
   <div class="decoration" style="bottom: 0; left: 15%; font-size: 45px; animation: sway 2.8s ease-in-out infinite;">
    üå≤
   </div>
   <div class="decoration" style="bottom: 0; right: 15%; font-size: 45px; animation: sway 3.2s ease-in-out infinite;">
    üå≤
   </div><!-- Presents -->
   <div class="decoration" style="bottom: 10px; left: 10%; font-size: 35px;">
    üéÅ
   </div>
   <div class="decoration" style="bottom: 10px; right: 10%; font-size: 35px;">
    üéÅ
   </div><!-- Lights -->
   <div class="decoration" style="top: 20%; left: 3%; font-size: 25px; animation: sway 2s ease-in-out infinite;">
    üí°
   </div>
   <div class="decoration" style="top: 30%; right: 3%; font-size: 25px; animation: sway 2.2s ease-in-out infinite;">
    üí°
   </div><!-- Stars -->
   <div class="decoration" style="top: 10%; left: 20%; font-size: 30px; animation: sway 4s ease-in-out infinite;">
    ‚≠ê
   </div>
   <div class="decoration" style="top: 15%; right: 20%; font-size: 30px; animation: sway 4.5s ease-in-out infinite;">
    ‚≠ê
   </div><!-- Snowman -->
   <div class="decoration" style="bottom: 0; left: 50%; transform: translateX(-50%); font-size: 50px;">
    ‚õÑ
   </div>
  </div>
  <script>
    // Create snowflakes
    function createSnowflakes() {
      const container = document.getElementById('snowflakes-container');
      for (let i = 0; i < 30; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = '‚ùÑÔ∏è';
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
        snowflake.style.animationDelay = Math.random() * 2 + 's';
        snowflake.style.fontSize = (Math.random() * 10 + 15) + 'px';
        container.appendChild(snowflake);
      }
    }
    createSnowflakes();
  </script>
  <script>
    const defaultConfig = {
      background_color: "#4d7c9f",
      card_background: "#ffffff",
      term_color: "#d32f2f",
      definition_color: "#1976d2",
      primary_action_color: "#2e7d32",
      text_color: "#1e293b",
      font_family: "Comic Sans MS",
      font_size: 16,
      game_title: "‚ùÑÔ∏è Winter Irregular Verbs Match ‚òÉÔ∏è",
      instructions_text: "Click all three forms of each verb: infinitive, past simple, and past participle!",
      hint_button_text: "üí° Need a Hint?",
      reset_button_text: "üîÑ Reset Game",
      completion_message: "Great!",
      timer_duration: 300
    };

    const vocabularyData = [
      // Correct verbs
      { infinitive: "be", pastSimple: "was/were", pastParticiple: "been", correctPast: true },
      { infinitive: "begin", pastSimple: "began", pastParticiple: "begun", correctPast: true },
      { infinitive: "break", pastSimple: "broke", pastParticiple: "broken", correctPast: true },
      { infinitive: "bring", pastSimple: "brought", pastParticiple: "brought", correctPast: true },
      { infinitive: "choose", pastSimple: "chose", pastParticiple: "chosen", correctPast: true },
      { infinitive: "do", pastSimple: "did", pastParticiple: "done", correctPast: true },
      { infinitive: "drink", pastSimple: "drank", pastParticiple: "drunk", correctPast: true },
      { infinitive: "drive", pastSimple: "drove", pastParticiple: "driven", correctPast: true },
      { infinitive: "eat", pastSimple: "ate", pastParticiple: "eaten", correctPast: true },
      { infinitive: "fall", pastSimple: "fell", pastParticiple: "fallen", correctPast: true },
      { infinitive: "fly", pastSimple: "flew", pastParticiple: "flown", correctPast: true },
      { infinitive: "forget", pastSimple: "forgot", pastParticiple: "forgotten", correctPast: true },
      { infinitive: "give", pastSimple: "gave", pastParticiple: "given", correctPast: true },
      { infinitive: "go", pastSimple: "went", pastParticiple: "gone", correctPast: true },
      { infinitive: "know", pastSimple: "knew", pastParticiple: "known", correctPast: true },
      { infinitive: "make", pastSimple: "made", pastParticiple: "made", correctPast: true },
      { infinitive: "see", pastSimple: "saw", pastParticiple: "seen", correctPast: true },
      { infinitive: "take", pastSimple: "took", pastParticiple: "taken", correctPast: true },
      { infinitive: "think", pastSimple: "thought", pastParticiple: "thought", correctPast: true },
      { infinitive: "write", pastSimple: "wrote", pastParticiple: "written", correctPast: true },
      { infinitive: "become", pastSimple: "became", pastParticiple: "become", correctPast: true },
      { infinitive: "buy", pastSimple: "bought", pastParticiple: "bought", correctPast: true },
      { infinitive: "catch", pastSimple: "caught", pastParticiple: "caught", correctPast: true },
      { infinitive: "come", pastSimple: "came", pastParticiple: "come", correctPast: true },
      { infinitive: "feel", pastSimple: "felt", pastParticiple: "felt", correctPast: true },
      { infinitive: "find", pastSimple: "found", pastParticiple: "found", correctPast: true },
      { infinitive: "get", pastSimple: "got", pastParticiple: "got/gotten", correctPast: true },
      { infinitive: "have", pastSimple: "had", pastParticiple: "had", correctPast: true }
    ];

    let selectedInfinitive = null;
    let selectedPastForm = null;
    let selectedParticiple = null;
    let matchedPairs = new Set();
    let hintsUsed = 0;
    let score = 0;
    let attempts = 0;
    let timerInterval = null;
    let timeRemaining = 0;

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // Generate success sound
    function playSuccessSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 523.25; // C5
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
      
      // Add second note
      const oscillator2 = audioContext.createOscillator();
      const gainNode2 = audioContext.createGain();
      oscillator2.connect(gainNode2);
      gainNode2.connect(audioContext.destination);
      oscillator2.frequency.value = 659.25; // E5
      oscillator2.type = 'sine';
      gainNode2.gain.setValueAtTime(0.3, audioContext.currentTime + 0.1);
      gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.6);
      oscillator2.start(audioContext.currentTime + 0.1);
      oscillator2.stop(audioContext.currentTime + 0.6);
    }

    // Generate error sound
    function playErrorSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 200;
      oscillator.type = 'sawtooth';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.3);
    }

    // Generate victory fanfare sound
    function playVictorySound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      
      // Triumphant ascending notes
      const notes = [
        { freq: 523.25, time: 0 },      // C5
        { freq: 659.25, time: 0.15 },   // E5
        { freq: 783.99, time: 0.3 },    // G5
        { freq: 1046.50, time: 0.45 }   // C6
      ];
      
      notes.forEach(note => {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = note.freq;
        oscillator.type = 'triangle';
        
        gainNode.gain.setValueAtTime(0.25, audioContext.currentTime + note.time);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + note.time + 0.6);
        
        oscillator.start(audioContext.currentTime + note.time);
        oscillator.stop(audioContext.currentTime + note.time + 0.6);
      });
    }

    function createConfetti(x, y) {
      const colors = ['#10b981', '#0ea5e9', '#8b5cf6', '#f59e0b', '#ef4444', '#ec4899'];
      for (let i = 0; i < 15; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti-piece';
        confetti.style.left = x + 'px';
        confetti.style.top = y + 'px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 0.3 + 's';
        confetti.style.animationDuration = (Math.random() * 1 + 2) + 's';
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 3000);
      }
    }

    function updateScoreDisplay() {
      const scoreElement = document.getElementById('score-display');
      const attemptsElement = document.getElementById('attempts-display');
      const accuracyElement = document.getElementById('accuracy-display');
      
      if (scoreElement) scoreElement.textContent = score;
      if (attemptsElement) attemptsElement.textContent = attempts;
      if (accuracyElement && attempts > 0) {
        const accuracy = Math.round((matchedPairs.size / attempts) * 100);
        accuracyElement.textContent = accuracy + '%';
      }
    }

    function selectCard(type, index, element) {
      if (matchedPairs.has(index)) return;

      if (type === 'infinitive') {
        if (selectedInfinitive === index) {
          selectedInfinitive = null;
          element.classList.remove('ring-4');
          return;
        }
        
        const previousInf = document.querySelector(`[data-inf-index="${selectedInfinitive}"]`);
        if (previousInf) previousInf.classList.remove('ring-4');
        
        selectedInfinitive = index;
        element.classList.add('ring-4');
        
        if (selectedPastForm !== null && selectedParticiple !== null) {
          checkMatch();
        }
      } else if (type === 'past') {
        if (selectedPastForm === index) {
          selectedPastForm = null;
          element.classList.remove('ring-4');
          return;
        }
        
        const previousPast = document.querySelector(`[data-past-index="${selectedPastForm}"]`);
        if (previousPast) previousPast.classList.remove('ring-4');
        
        selectedPastForm = index;
        element.classList.add('ring-4');
        
        if (selectedInfinitive !== null && selectedParticiple !== null) {
          checkMatch();
        }
      } else if (type === 'participle') {
        if (selectedParticiple === index) {
          selectedParticiple = null;
          element.classList.remove('ring-4');
          return;
        }
        
        const previousParticiple = document.querySelector(`[data-participle-index="${selectedParticiple}"]`);
        if (previousParticiple) previousParticiple.classList.remove('ring-4');
        
        selectedParticiple = index;
        element.classList.add('ring-4');
        
        if (selectedInfinitive !== null && selectedPastForm !== null) {
          checkMatch();
        }
      }
    }

    function checkMatch() {
      const infCard = document.querySelector(`[data-inf-index="${selectedInfinitive}"]`);
      const pastCard = document.querySelector(`[data-past-index="${selectedPastForm}"]`);
      const participleCard = document.querySelector(`[data-participle-index="${selectedParticiple}"]`);
      
      const infData = vocabularyData[selectedInfinitive];
      
      // Check if all three indices match and the verb is correct
      if (selectedInfinitive === selectedPastForm && selectedPastForm === selectedParticiple && infData.correctPast) {
        playSuccessSound();
        matchedPairs.add(selectedInfinitive);
        score += 10;
        attempts++;
        updateScoreDisplay();
        
        infCard.classList.add('celebrate');
        pastCard.classList.add('celebrate');
        participleCard.classList.add('celebrate');
        infCard.classList.remove('ring-4');
        pastCard.classList.remove('ring-4');
        participleCard.classList.remove('ring-4');
        
        const infRect = infCard.getBoundingClientRect();
        const pastRect = pastCard.getBoundingClientRect();
        const participleRect = participleCard.getBoundingClientRect();
        createConfetti(infRect.left + infRect.width / 2, infRect.top + infRect.height / 2);
        createConfetti(pastRect.left + pastRect.width / 2, pastRect.top + pastRect.height / 2);
        createConfetti(participleRect.left + participleRect.width / 2, participleRect.top + participleRect.height / 2);
        
        setTimeout(() => {
          infCard.style.opacity = '0';
          pastCard.style.opacity = '0';
          participleCard.style.opacity = '0';
          setTimeout(() => {
            infCard.style.display = 'none';
            pastCard.style.display = 'none';
            participleCard.style.display = 'none';
          }, 300);
        }, 500);
        
        if (matchedPairs.size === vocabularyData.filter(v => v.correctPast).length) {
          setTimeout(showCompletion, 800);
        }
        
        selectedInfinitive = null;
        selectedPastForm = null;
        selectedParticiple = null;
      } else {
        // Wrong match - shake and turn red, but allow correction
        playErrorSound();
        attempts++;
        updateScoreDisplay();
        
        infCard.classList.add('shake-error');
        pastCard.classList.add('shake-error');
        participleCard.classList.add('shake-error');
        
        setTimeout(() => {
          infCard.classList.remove('shake-error', 'ring-4');
          pastCard.classList.remove('shake-error', 'ring-4');
          participleCard.classList.remove('shake-error', 'ring-4');
          selectedInfinitive = null;
          selectedPastForm = null;
          selectedParticiple = null;
        }, 600);
      }
    }

    function showHint() {
      const correctVerbs = vocabularyData
        .map((verb, index) => ({ verb, index }))
        .filter(item => item.verb.correctPast && !matchedPairs.has(item.index));
      
      if (correctVerbs.length === 0) return;
      
      const randomItem = correctVerbs[Math.floor(Math.random() * correctVerbs.length)];
      const randomIndex = randomItem.index;
      
      const infCard = document.querySelector(`[data-inf-index="${randomIndex}"]`);
      const pastCard = document.querySelector(`[data-past-index="${randomIndex}"]`);
      const participleCard = document.querySelector(`[data-participle-index="${randomIndex}"]`);
      
      infCard.classList.add('hint-glow');
      pastCard.classList.add('hint-glow');
      participleCard.classList.add('hint-glow');
      
      setTimeout(() => {
        infCard.classList.remove('hint-glow');
        pastCard.classList.remove('hint-glow');
        participleCard.classList.remove('hint-glow');
      }, 2000);
      
      hintsUsed++;
      score = Math.max(0, score - 2);
      updateScoreDisplay();
    }

    function resetGame() {
      matchedPairs.clear();
      selectedInfinitive = null;
      selectedPastForm = null;
      selectedParticiple = null;
      hintsUsed = 0;
      score = 0;
      attempts = 0;
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      render(window.elementSdk.config);
    }

    function startTimer(duration) {
      timeRemaining = duration;
      updateTimerDisplay();
      
      if (timerInterval) clearInterval(timerInterval);
      
      timerInterval = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        
        if (timeRemaining <= 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          showTimeoutScreen();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const timerElement = document.getElementById('timer-display');
      if (timerElement) {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        // Change color when time is running out
        if (timeRemaining <= 30) {
          timerElement.style.color = '#d32f2f';
        } else if (timeRemaining <= 60) {
          timerElement.style.color = '#f57c00';
        }
      }
    }

    function showTimeoutScreen() {
      const config = window.elementSdk.config;
      const app = document.getElementById('app');
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      
      app.innerHTML = `
        <div class="min-h-full flex items-center justify-center p-8" style="background: linear-gradient(180deg, #4d7c9f 0%, #2c5f7f 100%);">
          <div class="text-center max-w-2xl" style="background: #ffffff; border-radius: 24px; padding: 64px 48px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="font-size: ${baseSize * 4}px; margin-bottom: 24px;">‚è∞</div>
            <h2 style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2}px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; margin-bottom: 16px;">Time's Up!</h2>
            <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-weight: 700; margin-bottom: 16px;">Score: ${score}</div>
            <p style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; margin-bottom: 32px;">Matched: ${matchedPairs.size}/${vocabularyData.filter(v => v.correctPast).length}</p>
            <button id="play-again-btn" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; padding: 16px 32px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s;">Try Again</button>
          </div>
        </div>
      `;
      
      document.getElementById('play-again-btn').onclick = resetGame;
    }

    function showCompletion() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      // Play victory fanfare
      playVictorySound();
      
      const config = window.elementSdk.config;
      const app = document.getElementById('app');
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      
      app.innerHTML = `
        <div class="min-h-full flex items-center justify-center p-8" style="background: linear-gradient(180deg, #4d7c9f 0%, #2c5f7f 100%); position: relative; overflow: hidden;">
          <!-- Snowflakes background -->
          <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
            ${Array.from({length: 30}, (_, i) => `
              <div style="position: absolute; top: -10px; left: ${Math.random() * 100}%; font-size: ${Math.random() * 20 + 10}px; animation: snowfall ${Math.random() * 3 + 2}s linear infinite; animation-delay: ${Math.random() * 2}s;">‚ùÑÔ∏è</div>
            `).join('')}
          </div>
          
          <!-- Santa Image -->
          <div style="position: absolute; top: 5%; left: 5%; font-size: 120px; animation: sway 3s ease-in-out infinite; z-index: 5;">üéÖ</div>
          
          <div class="text-center max-w-3xl" style="position: relative; z-index: 10;">
            <h2 style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 3}px; font-weight: 700; color: #fff; margin-bottom: 32px; text-shadow: 3px 3px 6px rgba(0,0,0,0.3);">${config.completion_message || defaultConfig.completion_message}</h2>
            
            <!-- Santa's Chest -->
            <div style="position: relative; margin: 0 auto 32px; width: 400px; height: 300px;">
              <!-- Chest SVG -->
              <svg id="santa-chest" viewBox="0 0 200 150" style="width: 100%; height: 100%;">
                <!-- Chest bottom -->
                <rect x="30" y="80" width="140" height="60" fill="#8B4513" stroke="#654321" stroke-width="3" rx="5"/>
                <rect x="35" y="85" width="130" height="50" fill="#A0522D"/>
                
                <!-- Chest lid (animated) -->
                <g id="chest-lid" style="transform-origin: 100px 80px; animation: openChest 1s ease-out forwards; animation-delay: 0.5s;">
                  <rect x="30" y="30" width="140" height="50" fill="#8B4513" stroke="#654321" stroke-width="3" rx="5"/>
                  <rect x="35" y="35" width="130" height="40" fill="#A0522D"/>
                  <ellipse cx="100" cy="55" rx="8" ry="10" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                </g>
                
                <!-- Gold coins inside (appear after chest opens) -->
                <g id="gold-coins" style="opacity: 0; animation: fadeInGold 0.5s ease-out forwards; animation-delay: 1.5s;">
                  <circle cx="80" cy="100" r="8" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                  <circle cx="100" cy="95" r="8" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                  <circle cx="120" cy="100" r="8" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                  <circle cx="90" cy="110" r="8" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                  <circle cx="110" cy="110" r="8" fill="#FFD700" stroke="#DAA520" stroke-width="2"/>
                  <text x="100" y="108" text-anchor="middle" fill="#DAA520" font-size="12" font-weight="bold">$$$</text>
                </g>
                
                <!-- Lock -->
                <rect x="95" y="75" width="10" height="8" fill="#FFD700" stroke="#DAA520" stroke-width="1" rx="2"/>
              </svg>
            </div>
            
            <!-- Results table -->
            <div id="results-table" style="background: rgba(255,255,255,0.95); border-radius: 16px; padding: 32px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); opacity: 0; animation: fadeInResults 0.5s ease-out forwards; animation-delay: 2s;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;">
                <div style="text-align: center; padding: 16px; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border-radius: 12px;">
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.75}px; color: #654321; font-weight: 600; margin-bottom: 8px;">Final Score</div>
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 4}px; font-weight: 700; color: #654321;">${score}</div>
                </div>
                <div style="text-align: center; padding: 16px; background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%); border-radius: 12px;">
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.75}px; color: #fff; font-weight: 600; margin-bottom: 8px;">Accuracy</div>
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 4}px; font-weight: 700; color: #fff;">${Math.round((matchedPairs.size / attempts) * 100)}%</div>
                </div>
              </div>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                <div style="text-align: center; padding: 12px; background: #e3f2fd; border-radius: 8px;">
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; color: #1565c0; margin-bottom: 4px;">Attempts</div>
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; font-weight: 700; color: #1565c0;">${attempts}</div>
                </div>
                <div style="text-align: center; padding: 12px; background: #fff3e0; border-radius: 8px;">
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; color: #e65100; margin-bottom: 4px;">Hints Used</div>
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; font-weight: 700; color: #e65100;">${hintsUsed}</div>
                </div>
                <div style="text-align: center; padding: 12px; background: #f3e5f5; border-radius: 8px;">
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; color: #6a1b9a; margin-bottom: 4px;">Time Left</div>
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; font-weight: 700; color: #6a1b9a;">${Math.floor(timeRemaining / 60)}:${(timeRemaining % 60).toString().padStart(2, '0')}</div>
                </div>
              </div>
              
              <button id="play-again-btn" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%); color: white; padding: 16px 48px; border-radius: 16px; border: none; cursor: pointer; font-weight: 700; transition: all 0.3s; box-shadow: 0 4px 15px rgba(211,47,47,0.4);">üéÆ Play Again</button>
            </div>
          </div>
        </div>
        
        <style>
          @keyframes snowfall {
            0% { transform: translateY(-10px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0.5; }
          }
          
          @keyframes openChest {
            0% { transform: rotateX(0deg); }
            100% { transform: rotateX(-120deg); }
          }
          
          @keyframes fadeInGold {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
          }
          
          @keyframes fadeInResults {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
          }
          
          @keyframes sway {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            50% { transform: translateX(10px) rotate(5deg); }
          }
          
          #play-again-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(211,47,47,0.6);
          }
        </style>
      `;
      
      document.getElementById('play-again-btn').onclick = resetGame;
    }

    function render(config) {
      const app = document.getElementById('app');
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      
      const shuffledInfinitives = shuffleArray(vocabularyData.map((item, index) => ({ ...item, originalIndex: index })));
      const shuffledPastForms = shuffleArray(vocabularyData.map((item, index) => ({ ...item, originalIndex: index })));
      const shuffledParticiples = shuffleArray(vocabularyData.map((item, index) => ({ ...item, originalIndex: index })));
      
      app.innerHTML = `
        <div class="min-h-full w-full" style="background: linear-gradient(180deg, ${config.background_color || defaultConfig.background_color} 0%, #2c5f7f 100%); padding: 0;">
          <!-- Timer Bar -->
          <div style="background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%); padding: 16px 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 16px;">
            <div style="display: flex; align-items: center; gap: 16px;">
              <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; font-weight: 700; color: #fff;">‚è±Ô∏è Time:</div>
              <div id="timer-display" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2}px; font-weight: 700; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); min-width: 100px;">5:00</div>
            </div>
            <div style="display: flex; align-items: center; gap: 8px;">
              <label style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: #fff; font-weight: 600;">‚öôÔ∏è Set Timer (seconds):</label>
              <input type="number" id="timer-input" min="30" max="1800" value="${config.timer_duration || defaultConfig.timer_duration}" style="font-family: ${customFont}, ${baseFontStack}; width: 80px; padding: 6px 12px; border-radius: 8px; border: 2px solid #fff; font-size: ${baseSize * 0.875}px; font-weight: 600;">
              <button id="update-timer-btn" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.75}px; background: #fff; color: #d32f2f; padding: 6px 16px; border-radius: 8px; border: none; cursor: pointer; font-weight: 700; transition: all 0.2s;">Apply</button>
            </div>
          </div>
          
          <div class="max-w-6xl mx-auto" style="padding: 48px 24px;">
            <header class="text-center mb-8">
              <h1 style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.5}px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; margin-bottom: 12px;">${config.game_title || defaultConfig.game_title}</h1>
              <p style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.125}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8; margin-bottom: 16px;">${config.instructions_text || defaultConfig.instructions_text}</p>
              
              <div style="display: flex; gap: 24px; justify-content: center; flex-wrap: wrap; background: ${config.card_background || defaultConfig.card_background}; padding: 16px 32px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto;">
                <div style="text-align: center;">
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; margin-bottom: 4px;">Score</div>
                  <div id="score-display" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.primary_action_color || defaultConfig.primary_action_color};">${score}</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; margin-bottom: 4px;">Attempts</div>
                  <div id="attempts-display" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${attempts}</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7; margin-bottom: 4px;">Accuracy</div>
                  <div id="accuracy-display" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.term_color || defaultConfig.term_color};">0%</div>
                </div>
              </div>
            </header>
            
            <div class="flex gap-4 justify-center mb-8 flex-wrap">
              <button id="hint-btn" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; padding: 12px 24px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s;">${config.hint_button_text || defaultConfig.hint_button_text}</button>
              <button id="reset-btn" style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.875}px; background: ${config.text_color || defaultConfig.text_color}; color: white; padding: 12px 24px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s;">${config.reset_button_text || defaultConfig.reset_button_text}</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-6xl mx-auto">
              <div>
                <h2 style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; font-weight: 600; color: ${config.term_color || defaultConfig.term_color}; margin-bottom: 16px; text-align: center;">üìñ Infinitive</h2>
                <div class="space-y-3">
                  ${shuffledInfinitives.map(item => `
                    <div data-inf-index="${item.originalIndex}" class="inf-card" style="background: ${config.card_background || defaultConfig.card_background}; padding: 20px 14px; border-radius: 12px; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 3px solid ${config.term_color || defaultConfig.term_color}; display: flex; align-items: center; justify-content: center; min-height: 54px;">
                      <p style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2.25}px; font-weight: 700; color: ${config.term_color || defaultConfig.term_color}; margin: 0; text-align: center;">${item.infinitive}</p>
                    </div>
                  `).join('')}
                </div>
              </div>
              
              <div>
                <h2 style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; font-weight: 600; color: ${config.definition_color || defaultConfig.definition_color}; margin-bottom: 16px; text-align: center;">‚èÆÔ∏è Past Simple</h2>
                <div class="space-y-3">
                  ${shuffledPastForms.map(item => `
                    <div data-past-index="${item.originalIndex}" class="past-card" style="background: ${config.card_background || defaultConfig.card_background}; padding: 20px 14px; border-radius: 12px; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 3px solid ${config.definition_color || defaultConfig.definition_color}; display: flex; align-items: center; justify-content: center; min-height: 54px;">
                      <p style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2}px; color: ${config.text_color || defaultConfig.text_color}; margin: 0; font-weight: 700; text-align: center;">${item.pastSimple}</p>
                    </div>
                  `).join('')}
                </div>
              </div>

              <div>
                <h2 style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.25}px; font-weight: 600; color: #f59e0b; margin-bottom: 16px; text-align: center;">‚úÖ Past Participle</h2>
                <div class="space-y-3">
                  ${shuffledParticiples.map(item => `
                    <div data-participle-index="${item.originalIndex}" class="participle-card" style="background: ${config.card_background || defaultConfig.card_background}; padding: 20px 14px; border-radius: 12px; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 3px solid #f59e0b; display: flex; align-items: center; justify-content: center; min-height: 54px;">
                      <p style="font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 2}px; color: ${config.text_color || defaultConfig.text_color}; margin: 0; font-weight: 700; text-align: center;">${item.pastParticiple}</p>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.querySelectorAll('.inf-card').forEach((card) => {
        const originalIndex = parseInt(card.dataset.infIndex);
        card.onclick = () => selectCard('infinitive', originalIndex, card);
      });
      
      document.querySelectorAll('.past-card').forEach((card) => {
        const originalIndex = parseInt(card.dataset.pastIndex);
        card.onclick = () => selectCard('past', originalIndex, card);
      });
      
      document.querySelectorAll('.participle-card').forEach((card) => {
        const originalIndex = parseInt(card.dataset.participleIndex);
        card.onclick = () => selectCard('participle', originalIndex, card);
      });
      
      document.getElementById('hint-btn').onclick = showHint;
      document.getElementById('reset-btn').onclick = resetGame;
      
      // Timer update functionality
      document.getElementById('update-timer-btn').onclick = () => {
        const newDuration = parseInt(document.getElementById('timer-input').value);
        if (newDuration >= 30 && newDuration <= 1800) {
          if (timerInterval) {
            clearInterval(timerInterval);
          }
          window.elementSdk.setConfig({ timer_duration: newDuration });
          startTimer(newDuration);
        }
      };
      
      // Start timer
      const timerDuration = config.timer_duration || defaultConfig.timer_duration;
      startTimer(timerDuration);
    }

    async function onConfigChange(config) {
      const correctVerbCount = vocabularyData.filter(v => v.correctPast).length;
      if (matchedPairs.size === correctVerbCount) {
        const app = document.getElementById('app');
        const customFont = config.font_family || defaultConfig.font_family;
        const baseSize = config.font_size || defaultConfig.font_size;
        const baseFontStack = 'system-ui, -apple-system, sans-serif';
        
        const completionContainer = app.querySelector('.text-center');
        if (completionContainer) {
          completionContainer.style.background = config.card_background || defaultConfig.card_background;
          
          const emoji = completionContainer.querySelector('div');
          emoji.style.fontSize = `${baseSize * 4}px`;
          
          const title = completionContainer.querySelector('h2');
          title.style.fontFamily = `${customFont}, ${baseFontStack}`;
          title.style.fontSize = `${baseSize * 2}px`;
          title.style.color = config.text_color || defaultConfig.text_color;
          title.textContent = config.completion_message || defaultConfig.completion_message;
          
          const scoreDiv = completionContainer.querySelectorAll('div')[1];
          scoreDiv.style.fontFamily = `${customFont}, ${baseFontStack}`;
          scoreDiv.style.fontSize = `${baseSize * 1.5}px`;
          scoreDiv.style.color = config.primary_action_color || defaultConfig.primary_action_color;
          
          const paragraphs = completionContainer.querySelectorAll('p');
          paragraphs.forEach(p => {
            p.style.fontFamily = `${customFont}, ${baseFontStack}`;
            p.style.color = config.text_color || defaultConfig.text_color;
          });
          
          const button = completionContainer.querySelector('button');
          button.style.fontFamily = `${customFont}, ${baseFontStack}`;
          button.style.fontSize = `${baseSize}px`;
          button.style.background = config.primary_action_color || defaultConfig.primary_action_color;
        }
        
        const wrapper = app.querySelector('.min-h-full');
        if (wrapper) {
          wrapper.style.background = config.background_color || defaultConfig.background_color;
        }
      } else {
        render(config);
      }
    }

    window.elementSdk.init({
      defaultConfig,
      onConfigChange,
      mapToCapabilities: (config) => ({
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.card_background || defaultConfig.card_background,
            set: (value) => {
              config.card_background = value;
              window.elementSdk.setConfig({ card_background: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              config.primary_action_color = value;
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          },
          {
            get: () => config.term_color || defaultConfig.term_color,
            set: (value) => {
              config.term_color = value;
              window.elementSdk.setConfig({ term_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            config.font_family = value;
            window.elementSdk.setConfig({ font_family: value });
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => {
            config.font_size = value;
            window.elementSdk.setConfig({ font_size: value });
          }
        }
      }),
      mapToEditPanelValues: (config) => new Map([
        ['game_title', config.game_title || defaultConfig.game_title],
        ['instructions_text', config.instructions_text || defaultConfig.instructions_text],
        ['hint_button_text', config.hint_button_text || defaultConfig.hint_button_text],
        ['reset_button_text', config.reset_button_text || defaultConfig.reset_button_text],
        ['completion_message', config.completion_message || defaultConfig.completion_message],
        ['timer_duration', String(config.timer_duration || defaultConfig.timer_duration)]
      ])
    });

    render(window.elementSdk.config);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b2a65b294ac8d6e',t:'MTc2NjUxOTUyNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>
